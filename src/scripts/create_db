import mysql.connector
from src.db.connect import connect_to_database

def create_tables():
    mydb = connect_to_database()
    if not mydb:
        return

    cursor = mydb.cursor()
    try:
        sql_create_tables = """
            CREATE TABLE IF NOT EXISTS Project (
                id INT PRIMARY KEY AUTO_INCREMENT,
                description TEXT,
                created_at DATETIME,
                user_id INT,
                name VARCHAR(64)
            );

            CREATE TABLE IF NOT EXISTS AnalysisTask (
                id INT PRIMARY KEY AUTO_INCREMENT,
                created_at DATETIME,
                user_id INT,
                project_id INT,
                name VARCHAR(64),
                status VARCHAR(64),
                FOREIGN KEY (project_id) REFERENCES Project(id)
            );

            CREATE TABLE IF NOT EXISTS MediaContent (
                id INT PRIMARY KEY AUTO_INCREMENT,
                description TEXT,
                user_id INT,
                title VARCHAR(128),
                type VARCHAR(32),
                file_path VARCHAR(128)
            );

            CREATE TABLE IF NOT EXISTS Report (
                id INT PRIMARY KEY AUTO_INCREMENT,
                content TEXT,
                created_at DATETIME,
                analysis_task_id INT,
                name VARCHAR(64),
                FOREIGN KEY (analysis_task_id) REFERENCES AnalysisTask(id)
            );

            CREATE TABLE IF NOT EXISTS TaskContent (
                media_content_id INT,
                analysis_task_id INT,
                FOREIGN KEY (media_content_id) REFERENCES MediaContent(id),
                FOREIGN KEY (analysis_task_id) REFERENCES AnalysisTask(id),
                PRIMARY KEY(media_content_id, analysis_task_id)
            );
        """
        cursor.execute(sql_create_tables, multi=True)
        mydb.commit()
        print("Таблиці успішно створено.")
    except mysql.connector.Error as err:
        print(f"Помилка створення таблиць: {err}")
    finally:
        cursor.close()
        mydb.close()


if __name__ == "__main__":
    create_tables()
